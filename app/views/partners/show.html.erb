<div class="container">

  <h4>Detalhe de Parceiro</h4>

    <!-- Page Heading/Breadcrumbs -->
    <%= render :partial => 'shared/header_backoffice' %>
    <!-- /.row -->  

  <div class="container">

    <p>
      <strong>ID:</strong>
      <%= @partner.id %>
    </p>

    <p>
      <strong>Name:</strong>
      <%= @partner.name %>
    </p>

    <p>
      <strong>Ordem de Apresentação:</strong>
      <%= @partner.order %>
    </p>

    <p>
      <strong>Alteração:</strong>
      <%= @partner.updated_at %>
    </p>

    <p>
      <strong>Status:</strong>
      <%= @partner.status_parceiro.nome rescue "" %>
    </p>

    <p>
      <strong>Saldo atual:</strong>
      KZ <%= number_to_currency(@partner.saldo_atual, :unit => "") %>
      <%= " - Última atualização em: #{Time.zone.now.strftime("%d/%m/%Y %H:%M")}" %>
    </p>

    <%= link_to edit_partner_path(@partner), class: 'btn btn-danger' do %>
      <span class="glyphicon glyphicon-edit"></span>
      Editar
    <% end %>

    <%= link_to partners_path, class: 'btn btn-danger' do %>
      <span class="glyphicon glyphicon-list-alt"></span>
      Voltar
    <% end %>

  </div>

  <% if @partner.slug.downcase == "zaptv" %>
    <hr>

    <%= link_to partner_importa_produtos_path(@partner), class: 'btn btn-danger' do %>
      Atualizar portfólio de produtos
    <% end %> <%= " - Última atualização em: #{UltimaAtualizacaoProduto.where(partner: @partner.id).first.updated_at.strftime("%d/%m/%Y %H:%M")}" rescue "" %>
    
    <br><br>

    <%= link_to partner_importa_dados_path(@partner), class: 'btn btn-danger' do %>
      Importar dados para relatório de reconciliação
    <% end %> <%= " - Última atualização em: #{UltimaAtualizacaoReconciliacao.where(partner: @partner.id).first.updated_at.strftime("%d/%m/%Y %H:%M")}" rescue "" %>

    <br><br>

    <h1>Relatório Reconciliação ZAPTV</h1>

    <div class="container" style="margin-top:10px">
      <form action="" method="get" id="formApuracao">
        <div class="row" style="padding:10px">
          <div class="col-sm-3">
            <div class="form-group">
              <label>Data Inicial</label>
              <div>
                <input type="date" name="data_inicio" value="<%= params[:data_inicio] %>" class="form-control">
              </div>
            </div>
          </div>
          <div class="col-sm-3">
            <div class="form-group">
              <label>Data Final</label>
              <div>
                <input type="date" name="data_fim" value="<%= params[:data_fim] %>" class="form-control">
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div style="float: right;margin-right:10px">
            <input type="hidden" name="csv" id="csv">
            <input type="submit" value="Buscar" onclick="$('#csv').val('');" class="btn btn-success">
            <input type="submit" value="Download CSV" onclick="$('#csv').val('ok');" class="btn btn-info navbar-btn btn-space mobile-botao">
            </a>
          </div>
        </div>
      </form>
    </div>
    <div class="container scroltable">
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">Operation Code</th>
            <th scope="col">Source Reference</th>
            <th colspan="3"></th>
          </tr>
          <tr>
            <th scope="col">ID ZAP</th>
            <th scope="col">ID Interno Pagasó</th>
            <th scope="col">Código do Produto</th>
            <th scope="col">Nome do Produto</th>
            <th scope="col">Quantidade</th>
            <th scope="col">Data</th>
            <th scope="col">Tipo</th>
            <th scope="col">Preço Total</th>
            <th scope="col">Status</th>
            <th scope="col">Preço Unitário</th>
            <th scope="col">Vendas</th>
            <th colspan="3"></th>
          </tr>
        </thead>
        <tbody>
          <% @relatorio_conciliacao_zaptvs.each do |relatorio_conciliacao_zaptv| %>
          <tr>
            <td><%= relatorio_conciliacao_zaptv.operation_code %></td>
            <td><%= relatorio_conciliacao_zaptv.source_reference %></td>
            <td><%= relatorio_conciliacao_zaptv.product_code %></td>
            <td><%= relatorio_conciliacao_zaptv.product_name %></td>
            <td><%= relatorio_conciliacao_zaptv.quantity %></td>
            <td><%= relatorio_conciliacao_zaptv.date_time.strftime("%d/%m/%Y %H:%M:%S") %></td>
            <td><%= relatorio_conciliacao_zaptv.type_data %></td>
            <td><%= relatorio_conciliacao_zaptv.total_price %></td>
            <td><%= relatorio_conciliacao_zaptv.status %></td>
            <td>
              KZ<%= number_to_currency(relatorio_conciliacao_zaptv.unit_price, :unit => "") %>
            </td>
            <td>
              Vendas:
              <ul>
                <% relatorio_conciliacao_zaptv.vendas.each do |venda| %>
                  <li>
                    <a href="/vendas/<%= venda.id %>">
                      Zappi(Número cartão): <%= JSON.parse(venda.request_send)["zappi"] %>
                    </a>
                  </li>
                <% end %>
              </ul>
            </td>
            <td><%= link_to 'Mostrar', relatorio_conciliacao_zaptv %></td>
          </tr>
          <% end %>
        </tbody>
      </table>

      <div class="apple_pagination">
        <%= will_paginate @relatorio_conciliacao_zaptvs, :container => false %>
      </div>
    </div>
  <% end %>
</div>
