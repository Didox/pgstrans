<div class="container scroltable">

  <h3>Matriz de Usuários</h3>

   <!-- Page Heading/Breadcrumbs -->
  <%= render :partial => 'shared/header_backoffice' %>
  <!-- /.row -->

  <div style="margin-top:10px">
    <form action="" method="get" id="formApuracao">
      <div class="row" style="padding:10px">
        <div class="col-sm-4">
          <div class="form-group">
            <label>Nome do Usuário</label>
            <div>
              <input type="text" name="nome" value="<%= params[:nome] %>" class="form-control">
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="form-group">
            <label>Login</label>
            <div>
              <input type="text" name="login" value="<%= params[:login] %>" class="form-control">
            </div>
          </div>
        </div>    
        <div class="col-sm-5">
          <div class="form-group">
            <label>Master Profile</label>
            <div>
              <select name="master_profile_id" onchange="pgstrans.carregaMasterProfile(this)" class="form-control">
                <option value="" selected="'selected'">Todos</option>
                <% MasterProfile.all.each do |master_profile| %>
                  <option value="<%= master_profile.id %>" <% if master_profile.id.to_s == params[:master_profile_id] %> selected="selected" <% end %> ><%= master_profile.description %></option>
                <% end %>
              </select>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <label>Subdistribuidor</label>
            <div>
              <select name="sub_distribuidor_id" onchange="pgstrans.carregaSubDistribuidor(this)" class="form-control">
                <option value="" selected="'selected'">Todos</option>
                <% SubDistribuidor.all.each do |sub_distribuidor| %>
                  <option value="<%= sub_distribuidor.id %>" <% if sub_distribuidor.id.to_s == params[:sub_distribuidor_id] %> selected="selected" <% end %> ><%= sub_distribuidor.nome %></option>
                <% end %>
              </select>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <label>Sugagente</label>
            <div>
              <select name="sub_agente_id" onchange="pgstrans.carregaSubAgente(this)" class="form-control">
                <option value="" selected="'selected'">Todos</option>
                <% SubAgente.all.each do |sub_agente| %>
                  <option value="<%= sub_agente.id %>" <% if sub_agente.id.to_s == params[:sub_agente_id] %> selected="selected" <% end %> ><%= sub_agente.nome_fantasia %></option>
                <% end %>
              </select>
            </div>
          </div>
        </div>       
      </div>
      <div class="form-group">
        <div style="float: right;margin-right:10px">
          <input type="submit" value="Buscar" class="btn btn-info">
          <%= link_to backoffice_index_path, class: 'btn btn-danger' do %>
            <span class="glyphicon glyphicon-list-alt"></span>
            Voltar
          <% end %>        
        </div>
    </form>
  </div>  

  <div class="container">
 
  <p class="text-left"><b>Relação e hierarquia dos clientes em relação ao serviço de venda</b></p>

    <table class="table table-hover">
      <thead>
        <tr>
          <th scope="col">Usuário</th>
          <th scope="col">Master Profile</th>
          <th scope="col">Subdistribuidor</th>
          <th scope="col">Subagente</th>
          <th scope="col">Filial</th>
          <th scope="col">PDV</th>
          <th colspan="3">Ações</th>
        </tr>
      </thead>

      <tbody>
        <% @matrix_users.each do |matrix_user| %>
          <tr>
            <td>
              <b>Login: </b><%= matrix_user.usuario.login rescue "" %><br>
              <b>Nome: </b><%= matrix_user.usuario.nome rescue "" %>
            </td>
            <td>
              <%= "#{matrix_user.master_profile}/#{matrix_user.master_profile_obj.description}" %>
            </td>
            <td>
              <%= "#{matrix_user.sub_distribuidor}/#{matrix_user.sub_distribuidor_obj.nome}" %>
            </td>
            <td>
              <%= "#{matrix_user.sub_agente}/#{matrix_user.sub_agente_obj.nome_fantasia}" %>
            </td>
            <td><%= matrix_user.filial %></td>
            <td><%= matrix_user.pdv %></td>
            <td><%= link_to 'Mostrar', matrix_user %></td>
            <td><%= link_to 'Editar', edit_matrix_user_path(matrix_user) %></td>
            <td><%= link_to 'Apagar', matrix_user, method: :delete, data: { confirm: 'Tem certeza?' } %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div class="apple_pagination">
      <%= will_paginate @matrix_users, :container => false %>
    </div> 

    <%= link_to new_matrix_user_path, class: 'btn btn-danger' do %>
      <span class="glyphicon glyphicon-plus"></span>
      Novo Registro
    <% end %>    

    <%= link_to backoffice_index_path, class: 'btn btn-danger' do %>
      <span class="glyphicon glyphicon-list-alt"></span>
      Voltar
    <% end %>
  </div>
</div>
