<div class="col-md-12 scroltable">
	<div class="col-md-12">
    <p id="notice"><%= notice %></p>
    <h3>Alterações de Pacotes de Produtos ou Planos de Cobrança DSTV</h3>
  </div>  
  <!-- Page Heading/Breadcrumbs -->
  <%= render :partial => 'shared/header_backoffice' %>
  <!-- /.row -->

  <div style="col-md-12 margin-top:10px">
    <form action="" method="get" id="formApuracao">
      <div class="col-sm-2">
        <div class="form-group">
          <label>Login do Usuário</label>
          <div>
            <input type="text" name="login" value="<%= params[:login] %>" class="form-control">
          </div>
        </div>
      </div> 
      <div class="col-sm-4">
        <div class="form-group">
          <label>Nome do Usuário</label>
          <div>
            <input type="text" name="nome" value="<%= params[:nome] %>" class="form-control">
          </div>
        </div>
      </div> 
      <div class="col-sm-2">
        <div class="form-group">
          <label>Número do Cliente DSTV</label>
          <div>
            <input type="text" name="customer_number" value="<%= params[:customer_number] %>" class="form-control">
          </div>
        </div>
      </div>
      <div class="col-sm-2">
        <div class="form-group">
          <label>Smartcard</label>
          <div>
            <input type="text" name="smartcard" value="<%= params[:smartcard] %>" class="form-control">
          </div>
        </div>
      </div>
      <div class="col-sm-2">
        <div class="form-group">
          <label>Recibo de Confirmação DSTV</label>
          <div>
            <input type="text" name="receipt_number" value="<%= params[:receipt_number] %>" class="form-control">
          </div>
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-group">
          <label>Tipo de Lançamento</label>
            <div>
              <select name="lancamento_id" onchange="pgstrans.carregaLancamento(this)" class="form-control">
                <option value="" selected="'selected'">Todos</option>
                <% Lancamento.all.each do |lancamento| %>
                  <option value="<%= lancamento.id %>" <% if lancamento.id.to_s == params[:lancamento_id] %> selected="selected" <% end %> ><%= lancamento.nome %></option>
                <% end %>
              </select>
          </div>
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-group">
          <label>Data da Transação</label>
          <div>
            <input type="date" name="transaction_date_time" value="<%= params[:transaction_date_time] %>" class="form-control">
          </div>
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-group">
          <label>Tipo de Plano</label>
          <div>
            <select name="tipo_plano" id="tipo_plano" class="form-control" style="width100%;max-width: 500px;">
              <option value="" <% if params[:tipo_plano].blank? %> selected="selected" <% end %>>
                Todos
              </option>
              <option value="mensal" <% if params[:tipo_plano] == "mensal" %> selected="selected" <% end %>>
                Mensal
              </option>
              <option value="anual" <% if params[:tipo_plano] == "anual" %> selected="selected" <% end %>>
                Anual
              </option>
            </select>
          </div>
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-group">
          <label>Nro. Transação Pagasó</label>
          <div>
            <input type="text" name="transaction_number" value="<%= params[:transaction_number] %>" class="form-control">
          </div>
        </div>
      </div> 
      <div class="form-group">
        <div style="float: right;margin-right:10px">
          <%= button_tag(type: 'submit', class: "btn btn-info", value: "Buscar", style: "width: 150px;text-align: center;margin-right: 0px;") do %>
               <span class="glyphicon glyphicon-search"></span> Buscar
            <% end %>
          <%= link_to 'javascript:history.go(-1)', class: 'btn btn-primary', style: "width: 150px;text-align: center;margin-right: 0px;" do %>
            <span class="glyphicon glyphicon-arrow-left"></span>
            Voltar
          <% end %>         
        </div>
      </div>
  </form>

  <h4 style="margin-left: 15px">Total de Transações: <strong><%= @alteracoes_planos_dstvs.count %></h4></strong>
  
  <table class="table scroltable table-hover">
    <thead>
      <tr>
        <th scope="col">Login / Nome do Usuário</th>
        <th scope="col">Dados DSTV</th>
        <th scope="col">Produto</th>
        <th scope="col" style="width: 12%" class="text-center">Valor KZ</th>
        <th scope="col">Recibo DSTV</th>
        <th scope="col">Tipo Transação</th>
        <th scope="col">Nro. Transação</th>
        <th scope="col">Confirmado?</th>
        <th scope="col">Data/Hora</th>
        <th scope="col">Tipo de Plano</th>
      </tr>
    </thead>

    <tbody>
      <% 
        valor_total = 0 
        @alteracoes_planos_dstvs.each do |alteracoes_planos_dstv| 
          valor_total += alteracoes_planos_dstv.value
      %>
        <tr>
          <td>
            <%= alteracoes_planos_dstv.usuario.login rescue "" %> /
            <%= alteracoes_planos_dstv.usuario.nome rescue "" %>
          </td>
          <td>
              <strong>Número do Cliente: </strong><%= alteracoes_planos_dstv.customer_number %><br>
              <strong>Smartcard: </strong><%= alteracoes_planos_dstv.smartcard %>
          </td>
          <td>
              <%= alteracoes_planos_dstv.codigos_produto %> /
              <%= alteracoes_planos_dstv.product_nome %>
          </td>
          <td class="text-right"><%= number_to_currency(alteracoes_planos_dstv.valor_original, :unit => "KZ") %></td>
          <td class="text-right"><%= alteracoes_planos_dstv.receipt_number %></td>
          <td><%= alteracoes_planos_dstv.lancamento.nome rescue "" %></td>
          <td class="text-center"><%= alteracoes_planos_dstv.transaction_number %></td>
          <td class="text-center"><%= alteracoes_planos_dstv.status ? "Sim" : "Não" %></td>
          <td><%= alteracoes_planos_dstv.transaction_date_time.to_datetime.strftime("%d/%m/%Y %H:%M:%S") rescue alteracoes_planos_dstv.transaction_date_time %></td>
          <td><%= alteracoes_planos_dstv.tipo_plano %></td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <td>
        </td>
        <td class="text-center"></td>
        <td class="text-right"><b>Total:</b></td>
        <td class="text-right"><b><%= number_to_currency(valor_total, :unit => "KZ") %></b></td>
        <td class="text-center"></td>
        <td class="text-center"></td>
        <td class="text-center"></td>
        <td class="text-center"></td>
        <td class="text-center"></td>
        <td></td>
      </tr>
    </tfoot>
  </table>
</div>

<h4>Total de Geral: <strong><%= number_to_currency(@alteracoes_planos_dstvs_valor, :unit => "KZ") %></h4></strong>

<div class="apple_pagination">
  <%= will_paginate @alteracoes_planos_dstvs, :container => false %>
</div> 

<%= link_to 'Voltar', 'javascript:history.go(-1)', class: 'btn btn-primary', style: "width: 150px;text-align: center;margin-right: 0px;" %>
